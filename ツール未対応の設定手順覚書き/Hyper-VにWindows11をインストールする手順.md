# Windows 11 に Hyper-V をインストールして仮想マシンを構築する手順

---

## 手順0：Windows 11 ISOファイルの入手

仮想マシンにインストールするため、Windows 11 のディスクイメージ（ISOファイル）を Microsoft の公式サイトからダウンロードする。

1.  以下のURLにアクセスする
    https://www.microsoft.com/ja-jp/software-download/windows11
2.  「x64 デバイス用 Windows 11 ディスク イメージ（ISO）をダウンロードする」セクションまでスクロールする
3.  「Windows 11（x64 デバイス用のマルチエディション ISO）」を選択し、「今すぐダウンロード」をクリックする
4.  表示される言語選択画面で「日本語」を選び、「確認」ボタンをクリックする
5.  「64ビット ダウンロード」ボタンが表示されたらクリックする
6.  保存ダイアログが表示されたら、保存先（例：デスクトップ）とファイル名（例：Win11_24H2_Japanese_x64.iso）を確認し、「保存(S)」をクリックする

※ ダウンロードリンクの有効期間は 24 時間である。仮想マシン作成時にこの ISO ファイルを指定する。

---

## 手順1：Hyper-V の有効化（インストール）

Hyper-V は Windows の機能として標準搭載されており、以下の手順で有効化する。

1.  コントロールパネルを開く
2.  「プログラムと機能」をクリックする
3.  左メニューの「Windows の機能の有効化または無効化」を選択する
4.  一覧から「Hyper-V」にチェックを入れて「OK」をクリックする
5.  インストールが完了したら、PC を再起動する

---

## 手順2：仮想ネットワークの準備（仮想スイッチの作成）

1.  再起動後、スタートメニューの検索バーで「Hyper-V マネージャー」を起動する
2.  右側ペインで「仮想スイッチマネージャー」をクリックする
3.  「新しい仮想ネットワークスイッチ」から「外部」を選択する
4.  「仮想スイッチの作成」をクリックする
5.  名前を「有線ネットワーク」「無線ネットワーク」などと設定する
6.  外部ネットワークの一覧から、使用中の有線（無線）LANアダプターを選択する（例：Realtek PCIe GbE、Intel Ethernet など）
7.  「OK」をクリックして保存する

※ Wi-Fi は不安定になりやすいため、LAN ケーブルの使用を推奨する。

---

## 手順3：仮想マシンの作成

1.  Hyper-V マネージャーで「新規 > 仮想マシン」をクリックする
2.  名前：「キッティングテスト機」など目的がわかりやすい名称を設定する
3.  世代：「第2世代」を選択する
4.  メモリ：「動的メモリを使用する」にチェックを入れる
    *   スタートアップRAM：4096MB（4GB）
    *   最大RAM：8192MB（8GB）
5.  ネットワーク：手順2で作成した仮想スイッチを選択する
6.  仮想ハードディスク：既定値のままにする（127GB 推奨）
7.  インストールオプション：
    *   「ブート イメージ ファイルからオペレーティングシステムをインストールする」を選択する
    *   手順0でダウンロードした ISO ファイルを指定する
8.  「完了」をクリックすると仮想マシンが作成される

---

## 手順4：Windows 11 のインストールと初期設定（トラブル対応含む）

1.  Hyper-V マネージャーで仮想マシンを右クリックし「接続」を選択する
2.  仮想マシンのウィンドウが表示されたら「起動」をクリックする
3.  「Press any key to boot from CD or DVD...」というメッセージが表示されたら、速やかに任意のキー（SpaceキーやEnterキーなど）を押す
4.  Windows セットアップが起動したら、画面の指示に従って進行する
5.  キーボードは「Japanese Keyboard (106/109 key)」を選択する

---

### トラブル1：プロダクトキー入力を求められる

→「プロダクトキーがありません」を選択してスキップする。

---

### トラブル2：「この PC では Windows 11 を実行できません」と表示される

1.  仮想マシンをシャットダウンする
2.  Hyper-V マネージャーで仮想マシンを右クリックし「設定」を選択する
3.  「セキュリティ」項目で以下にチェックを入れる：
    *   セキュアブートを有効にする
    *   トラステッドプラットフォームモジュール（TPM）を有効にする
4.  設定後、仮想マシンを再起動しインストールをやり直す

---

### トラブル3：PIN入力画面が表示されない

現象: Windows 11の初期設定完了後、PINの入力画面が表示されず、拡張セッション（クリップボード共有など）が利用できない。

解決策:
1.  まず、基本セッションで仮想マシンに接続する。（ウィンドウ上部にセッション切り替えボタンがある）■OneDriveを使用しない場合は削除する■
2.  基本セッションでサインイン後、Windowsの設定を変更する。
    *   「設定」 > 「アカウント」 > 「サインイン オプション」に移動する
    *   「セキュリティ向上のため、このデバイスではMicrosoft アカウント用にWindows Hello サインインのみを許可する (推奨)」という項目のスイッチをオフにする
3.  この設定変更後、一度サインアウトまたは再起動し、マイクロソフトアカウントでログインすると拡張セッションが利用可能になる。

---

### トラブル4：キーボード配列の問題（@を押すと[が入力される）

仮想環境で日本語キーボードの配列が正しく認識されない場合は、以下の手順で修正する。
1.  言語設定に移動する
    *   「設定」 > 「時刻と言語」 > 「言語と地域」 を選択する
2.  日本語の言語オプションを開く
    *   「日本語」の右側にある三点リーダー「…」をクリックして「言語のオプション」を選択する
3.  キーボードレイアウトを変更する
    *   「キーボード」セクションの「レイアウトを変更する」をクリックする
    *   「日本語キーボード (106/109 キー)」を選択する
4.  再起動する
    *   仮想環境を再起動して設定を反映させる

---

## 手順5：チェックポイントの作成

仮想マシンの初期状態を保存することで、以後何度でも同じ状態に戻して使用できる。

1.  セットアップ完了後、仮想マシンをシャットダウンする
2.  Hyper-V マネージャーで該当マシンを右クリックし「チェックポイント」を選択する
3.  自動で作成された名前に「初期設定完了_クリーン状態」などと変更を加える

---

## 手順6：テストサイクルの実行

チェックポイントを活用し、以下の流れで仮想マシンの検証作業を効率化する。

1.  チェックポイントから仮想マシンを起動する
2.  アプリのインストールや設定変更などを実行する
3.  問題があればチェックポイントを「適用」して状態を復元する
4.  テストを繰り返し実施する

---

## まとめ

*   Hyper-V により、Windows 11 の仮想マシンを安定かつ柔軟に構築できる。
*   ISO ダウンロードから仮想スイッチ、仮想マシン構築、トラブル対応までを網羅する。
*   チェックポイントを活用すれば、反復作業やテスト検証を高速かつ安全に行うことができる。

以上