# Windows 11 に Hyper-V をインストールして仮想マシンを構築する手順

---

## 手順0：Windows 11 ISOファイルの入手

仮想マシンにインストールするため、Windows 11 のディスクイメージ（ISOファイル）を Microsoft の公式サイトからダウンロードします。

1. 以下のURLにアクセスする  
   https://www.microsoft.com/ja-jp/software-download/windows11  

2. 「x64 デバイス用 Windows 11 ディスク イメージ（ISO）をダウンロードする」セクションまでスクロールする  

3. 「Windows 11（x64 デバイス用のマルチエディション ISO）」を選択し、「今すぐダウンロード」をクリック  

4. 表示される言語選択画面で「日本語」を選び、「確認」ボタンをクリック  

5. 「64ビット ダウンロード」ボタンが表示されたらクリック  

6. 保存ダイアログが表示されたら、保存先（例：デスクトップ）とファイル名（例：Win11_24H2_Japanese_x64.iso）を確認し、「保存(S)」をクリック  

※ ダウンロードリンクの有効期間は 24 時間です。仮想マシン作成時にこの ISO ファイルを指定します。

---

## 手順1：Hyper-V の有効化（インストール）

Hyper-V は Windows の機能として標準搭載されており、以下の手順で有効化できます。

1. コントロールパネルを開く  
2. 「プログラムと機能」をクリック  
3. 左メニューの「Windows の機能の有効化または無効化」を選択  
4. 一覧から「Hyper-V」にチェックを入れて「OK」  
5. インストールが完了したら、PC を再起動

---

## 手順2：仮想ネットワークの準備（仮想スイッチの作成）

1. 再起動後、「Hyper-V マネージャー」を起動  
2. 右側ペインで「仮想スイッチマネージャー」をクリック  
3. 「新しい仮想ネットワークスイッチ」→「外部」を選択  
4. 「仮想スイッチの作成」をクリック  
5. 名前を「有線ネットワーク」「無線ネットワーク」などと設定  
6. 外部ネットワークの一覧から、使用中の有線（無線）LANアダプターを選択（例：Realtek PCIe GbE、Intel Ethernet など）  
7. 「OK」をクリックして保存  

※ Wi-Fi は不安定になりやすいため、LAN ケーブルの使用を推奨します。

---

## 手順3：仮想マシンの作成

1. Hyper-V マネージャーで「新規 > 仮想マシン」をクリック  
2. 名前：「Windows_11_Test_VM」など目的がわかりやすい名称を設定  
3. 世代：「第2世代」を選択  
4. メモリ：「動的メモリを使用」にチェック  
   - スタートアップRAM：4096MB（4GB）  
   - 最大RAM：8192MB（8GB）  
5. ネットワーク：手順2で作成した仮想スイッチを選択  
6. 仮想ハードディスク：デフォルトのまま（127GB 推奨）  
7. インストールオプション：  
   - 「ブート イメージ ファイルからオペレーティングシステムをインストールする」を選択  
   - 手順0でダウンロードした ISO ファイルを指定  
8. 「完了」をクリックすると仮想マシンが作成される

---

## 手順4：Windows 11 のインストールと初期設定（トラブル対応含む）

1. Hyper-V マネージャーで仮想マシンを右クリック →「接続」  
2. 仮想マシンのウィンドウが表示されたら「起動」をクリック
3. 「Press any key to boot from CD or DVD...」メッセージが表示されたら、速やかに任意のキー（SpaceキーやEnterキーなど）を押す
4. Windows セットアップが起動するので画面に従って進行

---

### トラブル1：プロダクトキー入力を求められる

→「プロダクトキーがありません」を選択すればスキップ可能

---

### トラブル2：「この PC では Windows 11 を実行できません」と表示される

1. 仮想マシンをシャットダウン  
2. Hyper-V マネージャーで仮想マシンを右クリック →「設定」  
3. 「セキュリティ」項目で以下にチェックを入れる：  
   - セキュアブートを有効にする  
   - トラステッドプラットフォームモジュール（TPM）を有効にする  
4. 設定後、仮想マシンを再起動しインストールをやり直す

---

### トラブル3：PIN入力画面が表示されない

Windows 11インストール後にPIN入力画面が表示されない場合：

**即座の解決方法**
- Hyper-Vマネージャーで**基本セッション**を使用してください
- 拡張セッションではなく、通常の「接続」を選択

**拡張セッションを使用したい場合**
1. 基本セッションで接続後、以下の設定を変更：
   - スタートボタンを右クリック > 設定
   - アカウント > サインイン オプション
   - 「セキュリティ向上のため、このデバイスではMicrosoft アカウント用にWindows Hello サインインのみを許可する」をオフ
2. 設定後、拡張セッションが利用可能になります

---

### トラブル4：キーボード配列の問題（@を押すと[が入力される）

仮想環境で日本語キーボードの配列が正しく認識されない場合：

1. **設定画面を開く**
   - Windowsアイコンから歯車マークの「設定」を選択

2. **言語設定に移動**
   - 設定 > 時刻と言語 > 言語と地域 を選択

3. **日本語の言語オプションを開く**
   - 「日本語」の右側にある三点リーダー「…」をクリックして「言語のオプション」を選択

4. **キーボードレイアウトを変更**
   - 「キーボード」セクションの「レイアウトを変更する」をクリック
   - 「Japanese Keyboard (106/109 key)」を選択

5. **再起動**
   - 仮想環境を再起動して設定を反映

---

## 手順5：チェックポイントの作成

仮想マシンの初期状態を保存することで、以後何度でも同じ状態に戻して使えます。

1. セットアップ完了後、仮想マシンをシャットダウン  
2. Hyper-V マネージャーで該当マシンを右クリック →「チェックポイント」  
3. 自動で作成された名前を「初期設定完了_クリーン状態」などに変更

---

## 手順6：テストサイクルの実行

チェックポイントを活用し、以下の流れで仮想マシンの検証作業を効率化できます。

1. チェックポイントから仮想マシンを起動  
2. アプリインストールや設定変更などを実行  
3. 問題があればチェックポイントを「適用」して状態を復元  
4. テストを繰り返し実施可能

---

## まとめ

- Hyper-V により、Windows 11 の仮想マシンを安定かつ柔軟に構築可能  
- ISO ダウンロードから仮想スイッチ、仮想マシン構築、トラブル対応までを網羅  
- チェックポイントを活用すれば、反復作業やテスト検証が高速・安全に行える
- PIN入力画面問題やキーボード配列問題など、よくあるトラブルシューティングも含む

以上